FROM jenkins/inbound-agent:latest-jdk17

USER root

# Install required tools
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    python3-venv \
    make \
    docker-cli \
    && rm -rf /var/lib/apt/lists/*

# Create a python virtual environment
RUN python3 -m venv /opt/venv && chown -R jenkins:jenkins /opt/venv

# Activate the virtual environment
ENV PATH="/opt/venv/bin:$PATH"

# Give the jenkins user access to docker (assuming docker group ID is 1001 on the host)
# This may need to be adjusted based on your host's docker group ID and standardized across all hosts
# This might not be the best idea for production environments
RUN groupadd -g 1001 docker && usermod -aG docker jenkins

# Switch back to the jenkins user
USER jenkins